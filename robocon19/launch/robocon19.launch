<launch>

  <arg name="mode" default="normal"/>
  <arg name="zone" default="test_field"/>
  <arg name="bag" default="1"/>

  <!-- 機体中心とLRFの位置関係を定義 -->
  <node pkg="tf" type="static_transform_publisher" name="base_link_to_laser" args="0.0 -0.29 0.0 0.0 0.0 0.707 0.707 /base_link /laser 40" />
  <!-- <node pkg="tf" type="static_transform_publisher" name="map_to_odom" args="0.0 0.0 0.0 0.0 0.0 0 1 /map /odom 40" /> -->

  <group if="$(eval mode=='debug')">
    <param name="/use_sim_time" value="true"/>

    <!-- rosbagの実行 -->
    <node pkg="rosbag" type="play" name="player" args="--clock $(find robocon19_bag)/$(arg zone)/$(arg bag).bag"/>
  </group>

  <!-- mapサーバーの起動 -->
  <node name="map_server" pkg="map_server" type="map_server" args="$(find robocon19_map)/map/$(arg zone)/$(arg zone).yaml"/>

  <group if="$(eval mode=='normal')">
    <!-- LRFの起動 -->
    <include file="$(find robocon19_lrf)/launch/lidar.launch"/>

    <!-- mbedとの接続 -->
    <node pkg="rosserial_python" type="serial_node.py" name="serial_node">
      <param name="port" value="/dev/ttyACM0"/>
    </node>
  </group>

  <!-- <include file="$(find robocon19_laser_filters)/launch/laser_filter.launch"/> -->

  <!-- mbedの起動 -->
  <include file="$(find robocon19_mbed)/launch/robocon19_mbed.launch"/>

  <include file="$(find robocon19_localization)/launch/robocon19_localization.launch"/>

  <include file="$(find robocon19_diagnostics)/launch/robocon19_diagnostics.launch"/>

  <!-- レーザーオドメトリの起動（オドメータ不使用時） -->
  <!-- <include file="$(find robocon19_laser_odometry)/launch/laser_odometry.launch"/> -->

  <!-- 自己位置推定ノードの起動 -->

  <!-- その他機能の起動 -->
  <node name="robocon19_node" pkg="robocon19" type="robocon19_node" output="screen"/>

  <!-- rvizの起動 -->
  <arg name="rvizconfig" default="$(find robocon19)/rviz/SETTING.rviz" />
  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find robocon19)/rviz/SETTING.rviz" />

</launch>
